<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="QiniuResourceDaoImpl" >

	<resultMap class="com.fq.entity.vo.SpQiniuResourceVO" id="qiniuResourceVO">
		<result property="rId" column="r_id"/>
		<result property="qiniuKey" column="qiniu_key"/>
		<result property="localPath" column="local_path"/>
		<result property="resourceName" column="resource_name"/>
		<result property="remark" column="remark"/>
		<result property="createDt" column="create_dt"/>
		<result property="creatorName" column="creator_name"/>
		<result property="modifyDt" column="modify_dt"/>
		<result property="modifierName" column="modifier_name"/>
		<result property="resourceType" column="resource_type"/>
	</resultMap>
	
	<!-- selectQiniuResourceForPage 七牛资源分页查询  -->
	<select id="selectQiniuResourceForPage"  parameterClass="java.util.Map"  resultMap="qiniuResourceVO">
		select    		qr.r_id 			, qr.qiniu_key 	, qr.resource_type ,qr.local_path , 
						qr.resource_name 	, qr.remark 	, qr.create_dt	, qr.modify_dt,
						c.real_name creator_name , m.real_name modifier_name
 		from  			sp_qiniu_resource   		qr    
 		left join		bp_admin 	c on c.a_id = qr.creator 
 		left join		bp_admin	m on m.a_id = qr.modifier
 		<dynamic prepend="where">
 			<isNotEmpty property="resourceName" prepend="and"> qr.resource_name like concat('%',#resourceName#,'%') </isNotEmpty>
 			<isNotEmpty property="creatorName" prepend="and"> c.real_name like concat('%',#creatorName#,'%') </isNotEmpty>
 			<isNotEmpty property="qiniuKey" prepend="and"> qr.qiniu_key = #qiniuKey# </isNotEmpty>
 		</dynamic>
        order by   		qr.create_dt  desc 
        <include refid="page"/>
 		
	</select>
	
	<!--selectQiniuResourceForCount 查询项目总数量  -->
	<select id="selectQiniuResourceForCount"  parameterClass="java.util.Map"  resultClass="java.lang.Integer">
		select    		count(1) cnt
 		from  			sp_qiniu_resource   		qr    
 		left join		bp_admin 	c on c.a_id = qr.creator 
 		left join		bp_admin	m on m.a_id = qr.modifier
 		<dynamic prepend="where">
 			<isNotEmpty property="resourceName" prepend="and"> qr.resource_name like concat('%',#resourceName#,'%') </isNotEmpty>
 			<isNotEmpty property="creatorName" prepend="and"> c.real_name like concat('%',#creatorName#,'%') </isNotEmpty>
 			<isNotEmpty property="qiniuKey" prepend="and"> qr.qiniu_key = #qiniuKey# </isNotEmpty>
 		</dynamic>
	</select>
	
	<insert id="insertQiniuResource" parameterClass="com.fq.entity.po.SpQiniuResourcePO">
	
		INSERT INTO sp_qiniu_resource 
			(qiniu_key	, resource_name	, remark	, create_dt	, creator	,  rec_stat	,resource_type	) 
		VALUES 
			(#qiniuKey# , #resourceName#, #remark#	, now()		, #creator#	, 'Y'		,#resourceType#	);
	
	
	</insert>
	
	
	<insert id="insertQiniuUrlResource" parameterClass="com.fq.entity.po.SpQiniuResourcePO">
		INSERT INTO sp_qiniu_resource 
			(qiniu_key, resource_name, create_dt, creator,  rec_stat) 
		VALUES 
			(#qiniuKey#, #resourceName#,  now(), #creator#, 'Y');
	</insert>
</sqlMap>