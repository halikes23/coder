<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="BannerDaoImpl" >
	<resultMap class="com.fq.entity.po.CBannerInfo" id="banner">
		<result property="biId"				column="bi_id" />
		<result property="piId"			column="pi_id" />
		<result property="miId"			column="mi_id" />
		<result property="imgQiniuKey"			column="img_qiniukey" />
		<result property="bannerType"			column="banner_type" />
		<result property="orderIndex"			column="order_index" />
		<result property="url"			column="url" />
		<result property="episode" column="episode"/>
		<result property="visitCount" column="visit_count"/>
		<result property="isEnabled" column="is_enabled"/>
		<result property="busiId" column="busiId"/>
	</resultMap>
	
	<!-- selectCdkeyInfoList -->
	<select id="queryBanners" resultMap="banner" parameterClass="java.util.Map">
		select b.bi_id  , b.pi_id , b.mi_id , b.img_qiniukey , b.banner_type , b.order_index , b.url , b.episode , b.visit_count , 
		b.is_enabled , b.busi_id  busiId
 		
		from c_banner_info b
		where b.is_deleted = 'N' 
		<isNotEmpty property="isEnabled">
			and b.is_enabled = #isEnabled#
		</isNotEmpty>
		order by order_index desc
	</select>
	
	<insert id="insertBanner" parameterClass="com.fq.entity.po.CBannerInfo">
		INSERT INTO c_banner_info 
			( pi_id, mi_id, img_qiniukey, banner_type, order_index , url , episode , is_deleted ,visit_count , is_enabled , busi_id ) 
		VALUES 
			( #piId#, #miId#, #imgQiniuKey#, #bannerType#, #orderIndex# , #url# , #episode# , 'N'  , 0 , #isEnabled# , #busiId# )
		<selectKey resultClass="int" keyProperty="biId"> 
      		<![CDATA[SELECT LAST_INSERT_ID() AS biId ]]>   
      	</selectKey> 
	</insert>
	
	<delete id="deleteBannerBK" parameterClass="java.lang.Integer">
		delete from c_banner_info where bi_id = #bId#
	</delete>
	<update id="deleteBanner" parameterClass="java.lang.Integer">
		update c_banner_info  bi  set bi.is_deleted = 'Y' where bi.bi_id = #bId# 
	</update>
	
	<update id="updateBannerEnabled" parameterClass="com.fq.entity.po.CBannerInfo">
		update c_banner_info bi set bi.is_enabled = #isEnabled# where bi.bi_id = #biId#
	</update>
	
	<select id="selectBannerInfo" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select b.bi_id  biId  , b.pi_id  piId, b.mi_id miId , b.img_qiniukey imgQiniuKey , 
		b.banner_type bannerType , b.order_index  orderIndex, b.url url , b.episode episode , b.visit_count visitCount , 
		b.is_enabled isEnabled , b.busi_id  busiId
		from c_banner_info b
		where  b.bi_id=#biId# 
	</select>
	
	<update id="updateBannerInfo"  parameterClass="java.util.Map" >
		 update 	c_banner_info b 
		 			set  b.banner_type = #bannerType# ,
		 			b.busi_id = #busiId# , b.img_qiniukey = #imgQiniuKey#
		 where     b.bi_id=#biId# 
	</update>
	
	<update id="updateOrderIndex"  parameterClass="java.util.Map" >
		 update 	c_banner_info b 
		 set   b.order_index = #orderIndex# 
		 where     b.bi_id=#biId# 
	</update>
	
	
</sqlMap>