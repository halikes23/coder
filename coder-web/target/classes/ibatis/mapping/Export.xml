<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ExportDaoImpl" >
	<resultMap class="com.fq.dao.entity.vo.report.AllProjectRecordVO" id="allProjectResult">
		<result property="projectName" 		column="projectName"/>
		<result property="createDate" 		column="createDate"/>
		<result property="pcCnt" 			column="pcCnt"/>
		<result property="pliCnt" 			column="pliCnt"/>
		<result property="plcCnt" 			column="plcCnt"/>
		<result property="plrCnt"		    column="plrCnt"/>
		<result property="pccCnt"     		column="pccCnt"/>
		<result property="pbsCnt"     		column="pbsCnt"/>
		<result property="psCnt"     		column="psCnt"/>
		<result property="ppCnt"     		column="ppCnt"/>
		<result property="porCnt"     		column="porCnt"/>
		<result property="pcoCnt"     		column="pcoCnt"/>
	</resultMap>



	<select id="selectAllProjectName" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.ExportProjectNameVO">
		select 	pi.pi_id piId , pi.project_name projectName
		from 	p_project_info pi 
		<include refid="page"/>
	</select>
	
	<select id="selectProjectNameTotals" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select 	count(pi.pi_id)
		from 	p_project_info pi
	</select>
	
	<select id="selectCommentsByCreateDay" parameterClass="java.lang.Integer" resultClass="com.fq.dao.entity.ChartDateAndNumberVO">
		select left (pc.create_date , 10) createDate ,  count(pc.content) number from p_project_comment pc 
		where pc.pi_id = #piId# 
		group by  createDate
	</select>
	
	<select id="selectSingleProjectName" parameterClass="java.lang.Integer" resultClass="java.lang.String">
		select 	pi.project_name projectName
		from 	p_project_info pi
		where   pi.pi_id = #piId#  
	</select>
	
	<select id="selectAllProjectInfoCount" resultClass="com.fq.dao.entity.vo.ProjectRankVO">
		select pi.project_name projectName , pi.project_comm_nums commentNums , pi.project_log_nums logNums  
		from p_project_info pi 
	</select>
	
	<select id="selectProjectLogComment" resultClass="com.fq.dao.entity.ChartDateAndNumberVO">
		select left (pli.create_date , 10) createDate ,  sum(pli.comment_nums) number from p_project_log_info  pli
		where pli.pi_id = #piId#  
		group by  createDate
	</select>
	
	<select id="selectProjectLogPraise" parameterClass="java.lang.Integer" resultClass="com.fq.dao.entity.ChartDateAndNumberVO">
		select left (pli.create_date , 10) createDate ,  sum(pli.praise_nums) number from p_project_log_info  pli
		where pli.pi_id = #piId# 
		group by  createDate
	</select>
	
	<select id="selectCommentsInfo" parameterClass="java.lang.Integer" resultClass="com.fq.dao.entity.ChartCommentInfoVO">
		select left (pc.create_date , 10) createDate ,  sum(pc.like_nums) likeNums ,sum(pc.reply_nums) replyNums 
		from p_project_comment pc 
		where pc.pi_id = #piId#
		group by  createDate
	</select> 
	<!-- 查询指定凑份子记录的总数 -->
	<select id="queryAddHealRecordTotal" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select count(mham.mh_id)
			from u_movie_heal_account_map mham 
			left join p_project_movie_rel ppmr  on mham.m_id = ppmr.m_id
			left join p_project_info ppi on ppi.pi_id = ppmr.pi_id
			left join u_user_info ui on ui.account=mham.papa_account
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="projectName">ppi.project_name like concat('%',#projectName#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episode">ppmr.episode_no =#episode#</isNotEmpty>
			<isNotEmpty prepend="and " property="account"> ui.account like concat('%',#account#,'%')</isNotEmpty>
            <isNotEmpty prepend="and " property="userNick">ui.user_nick=#userNick#</isNotEmpty>
			 <isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format(  mham.heal_date, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  mham.heal_date, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
			
			<isNotEmpty prepend="and " property="isNavy">ui.is_navy=#isNavy#</isNotEmpty>
		</dynamic>
	</select>
	<!-- 查询当前页凑份子记录 -->
	<select id="queryAddHealRecord" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select ppi.project_name projectName  ,ppmr.episode_no episode,mham.papa_account account,
			ui.user_nick userNick ,mham.heal_amount healAmount,mham.heal_date healDate, ui.is_navy isNavy
			from u_movie_heal_account_map mham 
			left join p_project_movie_rel ppmr on mham.m_id = ppmr.m_id
			left join p_project_info ppi on ppi.pi_id = ppmr.pi_id
			left join u_user_info ui on ui.account=mham.papa_account
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="projectName">ppi.project_name like concat('%',#projectName#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episode">ppmr.episode_no =#episode#</isNotEmpty>
			<isNotEmpty prepend="and " property="account"> ui.account like concat('%',#account#,'%')</isNotEmpty>
            <isNotEmpty prepend="and " property="userNick">ui.user_nick=#userNick#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format(  mham.heal_date, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  mham.heal_date, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
			
			<isNotEmpty prepend="and " property="isNavy">ui.is_navy=#isNavy#</isNotEmpty>
		</dynamic>
			order by healDate desc
		<include refid="page"/>
	</select>
	<!-- 查询演员作品 -->
	<select id="queryActorProduction" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select ui.account,ui.user_nick userNick,ppi.project_name projectName,ppc.rachel_role rachelRole,ppi.create_date createDate
			from p_project_crew ppc
			left join u_user_info ui on ppc.actor_account=ui.account
			left join p_project_info ppi on ppc.pi_id=ppi.pi_id
			where ppi.project_name !=''
		<dynamic>
			<isNotEmpty prepend="and " property="account"> ui.account like concat('%',#account#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick">ui.user_nick like concat('%',#userNick#,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( ppi.create_date, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  ppi.create_date, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
			
		</dynamic>
		<include refid="page"/>
	</select>
	<!-- 查询演员作品总数 -->
	<select id="queryActorProductionTotal" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select count(ppc.c_id)
			from p_project_crew ppc
			left join u_user_info ui on ppc.actor_account=ui.account
			left join p_project_info ppi on ppc.pi_id=ppi.pi_id
			where ppi.project_name !=''
		<dynamic>
			<isNotEmpty prepend="and " property="account"> ui.account like concat('%',#account#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick">ui.user_nick like concat('%',#userNick#,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( ppi.create_date, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  ppi.create_date, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
			
			
		</dynamic>
	</select>
	<!-- 查询影片大爸爸 -->
	<select id="queryMovieBigpapa" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select mi.title, hm.papa_account papaAccount ,ui.user_nick userNick, sum(hm.heal_amount) healAmount  
			from u_movie_heal_account_map hm 
			left join  u_user_info ui  on ui.account = hm.papa_account
			left join m_movie_info mi on hm.m_id = mi.m_id
			left join p_project_movie_rel ppmr on ppmr.m_id=mi.m_id
			left join p_project_info ppi on ppi.pi_id=ppmr.pi_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="projectName"> ppi.project_name like concat('%',#projectName#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episode">ppmr.episode_no=#episode#</isNotEmpty>
            <isNotEmpty prepend="and " property="title">mi.title like concat ('%',#title#,'%')</isNotEmpty>
		</dynamic>
			group by hm.m_id ,hm.papa_account having healAmount>=1000
			order by healAmount desc ,  hm.heal_date asc
		<include refid="page"/>
	</select>
	<!-- 查询影片大爸爸总数 -->
	<select id="queryMovieBigpapaTotal" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select count(1) from 
		(select mi.title, hm.papa_account,ui.user_nick  
			from u_movie_heal_account_map hm 
			left join  u_user_info ui  on ui.account = hm.papa_account
			left join m_movie_info mi on hm.m_id = mi.m_id
			left join p_project_movie_rel ppmr on ppmr.m_id=mi.m_id
			left join p_project_info ppi on ppi.pi_id=ppmr.pi_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="projectName"> ppi.project_name like concat('%',#projectName#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episode">ppmr.episode_no=#episode#</isNotEmpty>
            <isNotEmpty prepend="and " property="title">mi.title like concat ('%',#title#,'%')</isNotEmpty>
		</dynamic>
			group by hm.m_id ,hm.papa_account having sum(hm.heal_amount)>=1000)t
	</select>
	<!-- 影片爸爸报表导出（不分页） -->
	<select id="selectMoviePapaWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.MoviePapaVO">
		select mi.title title , hm.papa_account account ,ui.user_nick userNick, ppmr.episode_no episodeNo , sum(hm.heal_amount) healAmount,ppi.project_name projectName
			from u_movie_heal_account_map hm 
			left join  u_user_info ui  on ui.account = hm.papa_account
			left join m_movie_info mi on hm.m_id = mi.m_id
			left join p_project_movie_rel ppmr on ppmr.m_id=mi.m_id
			left join p_project_info ppi on ppi.pi_id=ppmr.pi_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="projectName"> ppi.project_name like concat('%',#projectName#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episode">ppmr.episode_no=#episode#</isNotEmpty>
            <isNotEmpty prepend="and " property="title">mi.title like concat ('%',#title#,'%')</isNotEmpty>
		</dynamic>
			group by hm.m_id ,hm.papa_account having healAmount>=1000
			order by healAmount desc ,  hm.heal_date asc
	</select>
	
	<!-- 凑份子报表导出（不分页） -->
	<select id="selectAddHealRecordWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.AddHealRecordVO">
		select ppi.project_name projectName  ,ppmr.episode_no episodeNo,ui.user_nick userNick ,mham.papa_account account,
			mham.heal_amount healAmount,mham.heal_date healDate  ,   ui.is_navy isNavy
			from u_movie_heal_account_map mham 
			left join p_project_movie_rel ppmr on mham.m_id = ppmr.m_id
			left join p_project_info ppi on ppi.pi_id = ppmr.pi_id
			left join u_user_info ui on ui.account=mham.papa_account
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="projectName">ppi.project_name like concat('%',#projectName#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episode">ppmr.episode_no =#episode#</isNotEmpty>
			<isNotEmpty prepend="and " property="account"> ui.account like concat('%',#account#,'%')</isNotEmpty>
            <isNotEmpty prepend="and " property="userNick">ui.user_nick=#userNick#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format(mham.heal_date, '%Y-%m-%d')  >=  #selStartDate# ]]> </isNotEmpty>
            <isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(mham.heal_date, '%Y-%m-%d')     <=  #selEndDate#]]> </isNotEmpty>
			<isNotEmpty prepend="and " property="isNavy">ui.is_navy=#isNavy#</isNotEmpty>
		</dynamic>
			order by healDate desc
	</select>
	<!-- 查询弹幕 -->
	<select id="queryMovieBulletScreen" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select mdm.bs_id bsId,mdm.account account,mmi.title,mdm.`contents` content,
			mdm.client_type clientType,mdm.client_brand clientBrand,mdm.client_model clientModel,
			mdm.client_system_no clientSysNo,mdm.client_device_no clientDevNo
			from m_danmaku mdm
		left join m_movie_info mmi on mmi.m_id=mdm.m_id
		left join u_user_info uui on uui.account=mdm.account
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="content" >mdm.`contents` like concat ('%',#content#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientType" >mdm.client_type=#clientType#</isNotEmpty>
			<isNotEmpty prepend="and " property="clientBrand">mdm.client_brand like concat ('%',#clientBrand#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientModel">mdm.client_model like concat ('%',#clientModel#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientSysNo">mdm.client_system_no like concat ('%',#clientSysNo#,'%')</isNotEmpty>
		</dynamic>
		order by mdm.bs_id
		<include refid="page"/>
	</select>
	<!-- 弹幕总数量 -->
	<select id="queryMovieBulletScreenTotal" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select count(1)
			from m_danmaku mdm
			left join m_movie_info mmi on mmi.m_id=mdm.m_id
			left join u_user_info uui on uui.account=mdm.account
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="content">mdm.`contents` like concat ('%',#content#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientType">mdm.client_type=#clientType#</isNotEmpty>
			<isNotEmpty prepend="and " property="clientBrand">mdm.client_brand like concat ('%',#clientBrand#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientModel">mdm.client_model like concat ('%',#clientModel#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientSysNo">mdm.client_system_no like concat ('%',#clientSysNo#,'%')</isNotEmpty>
		</dynamic>
	</select>
	<!-- 删除单条弹幕 -->
	<delete id="deleteSingleMovieBulletScreen" parameterClass="java.util.Map">
		delete from m_danmaku where bs_id=#bsId#
	</delete>
	<!-- 修改弹幕信息 -->
	<update id="updateBulletScreen" parameterClass="com.fq.dao.entity.po.UpdateBulletScreenPO">
		update m_danmaku mdm set mdm.`contents`=#content#,mdm.client_type=#clientType#,
			mdm.client_brand=#clientBrand#,mdm.client_model=#clientModel#,
			mdm.client_system_no=#clientSysNo#,mdm.client_device_no=#clientDevNo#
		where mdm.bs_id=#bsId#
	</update>
	
	<!-- 导出考核报表 -->
	<select id="queryAllProjectRecordWithOutPage" parameterClass="java.util.Map" resultMap="allProjectResult">
			select
			pi.project_name projectName ,
			r.create_date 	createDate	,
			r.pc_cnt 		pcCnt		, 
			r.pli_cnt	 	pliCnt	 	, 
			r.plc_cnt 		plcCnt		,
			r.plr_cnt       plrCnt     ,
			r.pcc_cnt      pccCnt     ,
			r.pbs_cnt      pbsCnt    ,
			r.ps_cnt       psCnt    ,
			r.pp_cnt       ppCnt    ,
			r.por_cnt      porCnt   ,
			r.pco_cnt      pcoCnt
			from r_project_report r 
			left join p_project_info pi on r.pi_id = pi.pi_id
		<dynamic prepend="where">
			<isNotEmpty property="selStartDate" prepend="and"> <![CDATA[ r.create_date >= #selStartDate#  ]]> </isNotEmpty>
			<isNotEmpty property="selEndDate" prepend="and"> <![CDATA[ r.create_date <= #selEndDate#  ]]> </isNotEmpty>
		</dynamic> 
		order by r.create_date desc
	</select>
	<select id="queryProjectRecordWithOutPage" parameterClass="java.util.Map" resultMap="allProjectResult">
			select
			pi.project_name projectName ,
			r.create_date 	createDate	,
			r.pc_cnt 		pcCnt		, 
			r.pli_cnt	 	pliCnt	 	, 
			r.plc_cnt 		plcCnt		,
			r.plr_cnt       plrCnt     ,
			r.pcc_cnt      pccCnt     ,
			r.pbs_cnt      pbsCnt    ,
			r.ps_cnt       psCnt    ,
			r.pp_cnt       ppCnt    ,
			r.por_cnt      porCnt   ,
			r.pco_cnt      pcoCnt
			from r_project_report r 
			left join p_project_info pi on r.pi_id = pi.pi_id
			where r.pi_id=#piId#
		<dynamic>
			<isNotEmpty property="selStartDate" prepend="and"> <![CDATA[ r.create_date >= #selStartDate#  ]]> </isNotEmpty>
			<isNotEmpty property="selEndDate" prepend="and"> <![CDATA[ r.create_date <= #selEndDate#  ]]> </isNotEmpty>
		</dynamic> 
	</select>
	
	<select id="selectTradeInfoWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.pay.TradeInfoVO">
		select td.ta_id taId , td.entity_no entityNo ,td.entity_type entityType , 
		td.app_amt appAmt , td.app_vol appVol , CONCAT( td.app_dt , ' ' , td.app_tm ) date  , 
		td.cdkey cdkey ,td.busi_code busiCode ,td.contract_no contractNo ,td.receipt_data receiptData ,td.pmt_state pmtState ,
		td.pmt_channel pmtChannel
		from tp_trade_app  td 
		where td.busi_code = '7'
		<dynamic>     
            <isNotEmpty prepend="and" property="entityNo"> td.entity_no like concat('%',#entityNo#,'%')</isNotEmpty>
            <isNotEmpty prepend="and" property="contractNo"> td.contract_no like concat(#contractNo#,'%')</isNotEmpty>
            <isNotEmpty prepend="and" property="appVol"> td.app_vol =#appVol#</isNotEmpty>
            
            <isEqual prepend="and" property="pmtState" compareValue="1"> td.pmt_state = #pmtState# </isEqual> 
            <isEqual prepend="and" property="pmtState" compareValue="2"> td.pmt_state = #pmtState# </isEqual> 
            <isEqual prepend="and" property="pmtState" compareValue="3"> td.pmt_state = #pmtState# </isEqual> 
            <isEqual prepend="and" property="pmtState" compareValue="1000"> td.pmt_state is null </isEqual> 
            
            <isNotEmpty prepend="and" property="exchangeStartTime"> <![CDATA[ date_format( td.app_dt, '%Y%m%d')  >=  #exchangeStartTime# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="exchangeEndTime"> <![CDATA[ date_format( td.app_dt, '%Y%m%d')  <=  #exchangeEndTime# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="pmtChannel"> td.pmt_channel = #pmtChannel#</isNotEmpty>
        </dynamic>
        order by date desc 
	</select>
	
	<!-- 查询用户领取奖励列表信息 -->
	<select id="selectActiveAwardWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.ActiveAwardInfoVO">
	select 
	aai.active_award_id activeAwardId,	aai.account account , aai.mobile mobile , aai.active_id activeId ,
	aai.client_device_no clientDeviceNo , aai.have_award haveAward ,
	aai.create_dt createDt , aai.create_tm createTm 
	from a_active_award_info aai
	<dynamic prepend="where">
		<isNotEmpty prepend="and" property="account" > aai.account like concat('%',#account#,'%')</isNotEmpty>
		<isNotEmpty prepend="and" property="mobile"> aai.mobile like concat('%',#mobile#,'%')</isNotEmpty>
		<isNotEmpty prepend="and" property="clientDeviceNo"> aai.client_device_no =#clientDeviceNo#</isNotEmpty>
		<isNotEmpty prepend="and" property="haveAward"> aai.have_award =#haveAward#</isNotEmpty>
		<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( aai.create_dt , '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
		<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( aai.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
	</dynamic>
	order by  aai.create_dt  desc 
	</select>
	
	<select id="selectUnlockLivaCartoon" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		plc.cartoon_title cartoonTitle , rp.account  account , rp.create_dt  createDt, rp.create_tm  createTm,
		lcc.episode_no episodeNo , ui.user_nick  userNick, ui.is_navy  isNavy , rp.unlock_jpoint unlockJpoint
		from   plc_user_read_permision rp   
		left join plc_live_cartoon_chapter lcc  on lcc.lc_id = rp.lc_id
		left join plc_live_cartoon plc on  plc.plc_id=lcc.plc_id  
		left join u_user_info ui on ui.account = rp.account 
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="cartoonTitle" > plc.cartoon_title like concat('%',#cartoonTitle#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="account" > rp.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episodeNo"> lcc.episode_no  =#episodeNo#</isNotEmpty>
			<isNotEmpty prepend="and " property="isNavy"> ui.is_navy =#isNavy#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format(  rp.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  rp.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
		</dynamic>
		order by rp.create_dt  desc
		<include refid="page"/>
	</select>
	
	<select id="selectUnlockLiveCartoonTotal" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select 
		count(rp.urp_id)
		from   plc_user_read_permision rp   
		left join plc_live_cartoon_chapter lcc  on lcc.lc_id = rp.lc_id
		left join plc_live_cartoon plc on  plc.plc_id=lcc.plc_id  
		left join u_user_info ui on ui.account = rp.account 
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="cartoonTitle" > plc.cartoon_title like concat('%',#cartoonTitle#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="account" > rp.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episodeNo"> lcc.episode_no =#episodeNo#</isNotEmpty>
			<isNotEmpty prepend="and " property="isNavy"> ui.is_navy =#isNavy#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( rp.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  rp.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
		</dynamic>
	</select>
	<!-- 漫画解锁信息报表导出 -->
	<select id="selectUnlockLiveCartoonWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.UnlockLiveCartoonVO">
		select 
		plc.cartoon_title cartoonTitle , rp.account  account , rp.create_dt  createDt, rp.create_tm  createTm,
		lcc.episode_no episodeNo , ui.user_nick  userNick, ui.is_navy  isNavy , rp.unlock_jpoint unlockJpoint
		from   plc_user_read_permision rp   
		left join plc_live_cartoon_chapter lcc  on lcc.lc_id = rp.lc_id
		left join plc_live_cartoon plc on  plc.plc_id=lcc.plc_id  
		left join u_user_info ui on ui.account = rp.account 
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="cartoonTitle" > plc.cartoon_title like concat('%',#cartoonTitle#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="account" > rp.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="episodeNo"> lcc.episode_no  =#episodeNo#</isNotEmpty>
			<isNotEmpty prepend="and " property="isNavy"> ui.is_navy =#isNavy#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format(  rp.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]></isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format(  rp.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]></isNotEmpty>
		</dynamic>
		order by rp.create_dt  desc
	</select>
	
	<!-- 历史订单查询数据报表导出 -->
	<select id="selectHistroyTradeInfoWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.pay.HistroyTradeInfoVO">
		select td.ta_id taId , td.entity_no entityNo ,td.entity_type entityType , 
		td.app_amt appAmt , td.app_vol appVol , CONCAT( td.app_dt , ' ' , td.app_tm ) date  , 
		td.cdkey cdkey ,td.busi_code busiCode ,td.contract_no contractNo ,td.receipt_data receiptData ,td.pmt_state pmtState ,
		td.pmt_channel pmtChannel
		from his_trade_app  td 
		where td.busi_code = '7'
		<dynamic>     
            <isNotEmpty prepend="and" property="entityNo"> td.entity_no like concat('%',#entityNo#,'%')</isNotEmpty>
            <isNotEmpty prepend="and" property="contractNo"> td.contract_no like concat(#contractNo#,'%')</isNotEmpty>
            <isNotEmpty prepend="and" property="appVol"> td.app_vol =#appVol#</isNotEmpty>
            
            <isEqual prepend="and" property="pmtState" compareValue="1"> td.pmt_state = #pmtState# </isEqual> 
            <isEqual prepend="and" property="pmtState" compareValue="2"> td.pmt_state = #pmtState# </isEqual> 
            <isEqual prepend="and" property="pmtState" compareValue="3"> td.pmt_state = #pmtState# </isEqual> 
            <isEqual prepend="and" property="pmtState" compareValue="1000"> td.pmt_state is null </isEqual> 
            
            <isNotEmpty prepend="and" property="exchangeStartTime"> <![CDATA[ date_format( td.app_dt, '%Y%m%d')  >=  #exchangeStartTime# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="exchangeEndTime"> <![CDATA[ date_format( td.app_dt, '%Y%m%d')  <=  #exchangeEndTime# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="pmtChannel"> td.pmt_channel = #pmtChannel#</isNotEmpty>
        </dynamic>
        order by date desc 
	</select>
	<!-- 用户购买选票查询 -->
	<select id="selectBuyVote" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT   ujl.account account,ui.user_nick userNick , oav.vote_name voteName , oav.vote_type voteType, -sum(ujl.j_point) jpoint , ujl.write_date writeDate
		from l_user_jpoint_log ujl 
		left join u_user_info ui on ujl.account = ui.account 
		left join o_oscar_active_vote oav on oav.vote_type = ujl.op_id 
		where ujl.op= '22' 
		group by ujl.write_date   
		<dynamic>
			<isNotEmpty prepend="and " property="account" > ujl.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and"  property="selStartDate"> <![CDATA[ date_format( ujl.write_date, '%Y-%m-%d %H:%m:%s')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and"  property="selEndDate"> <![CDATA[ date_format( ujl.write_date, '%Y-%m-%d %H:%m:%s')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
			order  by ujl.write_date desc
			<include refid="page"/>
	</select>
	<!-- 用户购买选票查询报表导出 -->
	<select id="selectBuyVoteWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.BuyVoteReportVO">
		SELECT   ujl.account account,ui.user_nick userNick , oav.vote_name voteName , oav.vote_type voteType, -sum(ujl.j_point) jpoint  , ujl.write_date writeDate
		from l_user_jpoint_log ujl 
		left join u_user_info ui on ujl.account = ui.account 
		left join o_oscar_active_vote oav on oav.vote_type = ujl.op_id 
		where ujl.op= '22' 
		group by ujl.write_date  
		<dynamic>
			<isNotEmpty prepend="and " property="account" > ujl.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and"  property="selStartDate"> <![CDATA[ date_format( ujl.write_date, '%Y-%m-%d %H:%m:%s')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and"  property="selEndDate"> <![CDATA[ date_format( ujl.write_date, '%Y-%m-%d %H:%m:%s')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
		order  by ujl.write_date desc
	</select>
	<select id="selectBuyVoteTotals" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		SELECT  
		count(ujl.l_id)
		from l_user_jpoint_log ujl 
		left join u_user_info ui on ujl.account = ui.account 
		left join o_oscar_active_vote oav on oav.vote_type = ujl.op_id 
		where ujl.op= '22' 
		<dynamic>
			<isNotEmpty prepend="and " property="account" > ujl.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and"  property="selStartDate"> <![CDATA[ date_format( ujl.write_date, '%Y-%m-%d %H:%m:%s')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and"  property="selEndDate"> <![CDATA[ date_format( ujl.write_date, '%Y-%m-%d %H:%m:%s')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
	</select>
	<!-- 用户投票记录查询 -->
	<select id="selectVoteLog" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select oavl.opr_account oprAccount , ui.user_nick oprUserNick  , oav.vote_name voteName , oav.vote_type voteType ,
		oavl.actor_account actorAccount , ua.user_nick actorUserNick , oavl.create_dt writeDate
		from l_oscar_actor_vote_log  oavl 
		left join u_user_info ui on ui.account = oavl.opr_account 
		left join u_user_info ua on ua.account = oavl.actor_account  
		left join o_oscar_active_vote oav on oav.vote_type = oavl.oav_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="oprAccount" > oavl.opr_account like concat('%' , #oprAccount# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="oprUserNick" > ui.user_nick like concat('%', #oprUserNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and " property="actorAccount" > oavl.actor_account like concat('%' , #actorAccount# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="actorUserNick" > ua.user_nick like concat('%', #actorUserNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( oavl.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( oavl.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
			<include refid="page"/>
	</select>
	
	<select id="selectVoteLogTotals" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select 
		count(oavl.oavl_id)
		from l_oscar_actor_vote_log  oavl 
		left join u_user_info ui on ui.account = oavl.opr_account 
		left join u_user_info ua on ua.account = oavl.actor_account  
		left join o_oscar_active_vote oav on oav.vote_type = oavl.oav_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="oprAccount" > oavl.opr_account like concat('%' , #oprAccount# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="oprUserNick" > ui.user_nick like concat('%', #oprUserNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and " property="actorAccount" > oavl.actor_account like concat('%' , #actorAccount# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="actorUserNick" > ua.user_nick like concat('%', #actorUserNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( oavl.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( oavl.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
	</select>
	<!-- 用户投票记录查询报表导出 -->
	<select id="selectVoteLogWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.VoteLogReportVO">
		select oavl.opr_account oprAccount , ui.user_nick oprUserNick  , oav.vote_name voteName , oav.vote_type voteType ,
		oavl.actor_account actorAccount , ua.user_nick actorUserNick , oavl.create_dt writeDate
		from l_oscar_actor_vote_log  oavl 
		left join u_user_info ui on ui.account = oavl.opr_account 
		left join u_user_info ua on ua.account = oavl.actor_account  
		left join o_oscar_active_vote oav on oav.vote_type = oavl.oav_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="oprAccount" > oavl.opr_account like concat('%' , #oprAccount# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="oprUserNick" > ui.user_nick like concat('%', #oprUserNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and " property="actorAccount" > oavl.actor_account like concat('%' , #actorAccount# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="actorUserNick" > ua.user_nick like concat('%', #actorUserNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( oavl.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( oavl.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
	</select>
	<!-- 用户赠送选票查询 -->
	<select id="selectGiveVote" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select uvcl.account account,ui.user_nick userNick  , oav.vote_name voteName , oav.vote_type voteType, uvcl.create_dt writeDate
		from l_user_vote_change_log uvcl 
		left join u_user_info ui on ui.account = uvcl.account 
		left join o_oscar_active_vote oav on oav.vote_type = uvcl.oav_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="account" > uvcl.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( uvcl.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( uvcl.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
			<include refid="page"/>
	</select>
	
	<select id="selectGiveVoteTotals" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select 
		count(uvcl.uvcl_id)
		from l_user_vote_change_log uvcl 
		left join u_user_info ui on ui.account = uvcl.account 
		left join o_oscar_active_vote oav on oav.vote_type = uvcl.oav_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="account" > uvcl.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( uvcl.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( uvcl.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 用户赠送选票查询报表导出 -->
	<select id="selectGiveVoteWithOutPage" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.report.GiveVoteReportVO">
		select uvcl.account account,ui.user_nick userNick  , oav.vote_name voteName , oav.vote_type voteType, uvcl.create_dt writeDate
		from l_user_vote_change_log uvcl 
		left join u_user_info ui on ui.account = uvcl.account 
		left join o_oscar_active_vote oav on oav.vote_type = uvcl.oav_id
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="account" > uvcl.account like concat('%' , #account# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="userNick" > ui.user_nick like concat('%', #userNick# ,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="voteType"> oav.vote_type  = #voteType#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( uvcl.create_dt, '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( uvcl.create_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
		</dynamic>
	</select>
	
	<select id="queryUserInfoList" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.user.UserInfoVO">
		select 	ui.user_sn userSn , ui.account account , ui.user_nick userNick , ui.user_role userRole , ui.is_tester isTester ,
		ui.is_navy isNavy   , ui.pwd pwd  , ui.head_img_url headImgUrl , ui.is_gag isGag  , ui.user_sub_role userSubRole ,
		ui.is_vip isVip , ui.vip_out_dt vipOutDt  ,  date_format(ui.write_date , '%Y-%m-%d %H:00')  writeDate  , ui.is_manager isManager
		from 	u_user_info ui  
		<dynamic prepend="where">     
			<isNotEmpty prepend="and" property="userNick"> ui.user_nick like concat('%',#userNick#,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="account"> ui.account like concat(#account#,'%')</isNotEmpty>
			<isNotEmpty prepend="and" property="userRole"> ui.user_role = #userRole#</isNotEmpty>
			<isNotEmpty prepend="and" property="isGag"> ui.is_gag = #isGag#</isNotEmpty>
			<isNotEmpty prepend="and" property="userSubRole"> ui.user_sub_role = #userSubRole#</isNotEmpty>
			<isNotEmpty prepend="and" property="isVip"> ui.is_vip= #isVip#</isNotEmpty>
			<isNotEmpty prepend="and" property="isManager"> ui.is_manager= #isManager#</isNotEmpty>
			<isNotEmpty prepend="and" property="selStartDate"> <![CDATA[ date_format( ui.vip_out_dt , '%Y-%m-%d')  >=  #selStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selEndDate"> <![CDATA[ date_format( ui.vip_out_dt, '%Y-%m-%d')  <=  #selEndDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selectStartDate"> <![CDATA[ date_format( ui.write_date , '%Y-%m-%d')  >=  #selectStartDate# ]]>  </isNotEmpty>
			<isNotEmpty prepend="and" property="selectEndDate"> <![CDATA[ date_format( ui.write_date, '%Y-%m-%d')  <=  #selectEndDate# ]]>  </isNotEmpty>
        </dynamic>
	</select>
	
	<select id="selectMovieBulletScreen" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.vo.BulletScreenVO">
		select mdm.bs_id bsId,mdm.account account,mmi.title,mdm.`contents` content,
			mdm.client_type clientType,mdm.client_brand clientBrand,mdm.client_model clientModel,
			mdm.client_system_no clientSysNo,mdm.client_device_no clientDevNo
			from m_danmaku mdm
		left join m_movie_info mmi on mmi.m_id=mdm.m_id
		left join u_user_info uui on uui.account=mdm.account
		<dynamic prepend="where">
			<isNotEmpty prepend="and " property="content" >mdm.`contents` like concat ('%',#content#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientType" >mdm.client_type=#clientType#</isNotEmpty>
			<isNotEmpty prepend="and " property="clientBrand">mdm.client_brand like concat ('%',#clientBrand#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientModel">mdm.client_model like concat ('%',#clientModel#,'%')</isNotEmpty>
			<isNotEmpty prepend="and " property="clientSysNo">mdm.client_system_no like concat ('%',#clientSysNo#,'%')</isNotEmpty>
		</dynamic>
		order by mdm.bs_id
		<include refid="page"/>
	</select>
	
	<select id="selectUserMobileInfoList" parameterClass="java.util.Map" resultClass="com.fq.dao.entity.UserMobileVO">
			select cci.client_type clientType,cci.client_brand clientBrand,cci.client_model clientModel,
				cci.client_system_no clientSysNo,cci.client_device_no clientDevNo
			from c_client_info cci 
		<dynamic prepend="where">
			<isNotEmpty property="clientType" prepend="and">cci.client_type like concat ('%',#clientType#,'%')</isNotEmpty>
		</dynamic>
		order by cci.ci_id
		<include refid="page"/>
	</select>
</sqlMap>